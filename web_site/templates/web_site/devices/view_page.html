{% extends "web_site/base.html" %}

{% load static %}

{% block title %}{{block.super}} - Устройства: просмотр{% endblock %}

{% block content %}
<div class="row">
    <div class="col">
        <div class="row">
            <div class="col">
                <h1>Устройства:</h1>
            </div>
        </div>
        <div class="row" style="justify-content: flex-end; margin-bottom: 1%;">
            <div class="col-1">
                <a href="{% url 'web_site:device_detail' 0 %}">
                    <button class="btn btn-success">Добавить</button>
                </a>
            </div>
        </div>
        <table class="table">
            <tr>
                <th>Наименование</th>
                <th>IMEI</th>
                <th>Телефон</th>
                <th></th>
            </tr>
            {% for device in devices%}
            <tr>
                <td>{{device.name}}</td>
                <td>{{device.imei}}</td>
                <td>{{device.phone}}</td>
                <td>
                    <a data-action="edit" href="{% url 'web_site:device_detail' device.id %}"><i
                            class="fas fa-edit"></i></a>
                    <a data-action="delete" href="{% url 'api:device' device.id %}"><i class="fas fa-trash-alt"></i></a>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>

<script>
        document.getElementsByTagName('table')[0].addEventListener('click', function(event) {
            if (event.target.tagName == 'I' && event.target.closest('A').dataset['action'] == 'delete') {
                event.preventDefault()
                const a = event.target.closest('A')
                axios({
                    method: 'delete',
                    url: a.href,
                    headers: {
                        'X-CSRFToken': '{{csrf_token}}'
                    }
                }).then(response => {
                    if (response.status == 204) {
                        a.closest('TR').hidden = true;
                    }
                })
            }
        })

</script>
<!--    <script src="{% static '/web_site/js/devices.js' %}"></script>-->
{% endblock %}

